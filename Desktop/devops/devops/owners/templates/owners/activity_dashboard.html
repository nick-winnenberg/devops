
{% extends "owners/base.html" %}
{% load dict_extras %}
{% block content %}

<div class="row mb-4">
    <div class="col">
        <h2 class="fw-bold">Activity Dashboard</h2>
        <p class="text-muted">Recent activity by you.</p>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header fw-bold">Filter Activity</div>
    <div class="card-body">
        <form method="get" action="">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="start_date" class="form-label">Start Date</label>
                    <input type="date" id="start_date" name="start_date" class="form-control" value="{{ request.GET.start_date }}">
                </div>
                <div class="col-md-4">
                    <label for="end_date" class="form-label">End Date</label>
                    <input type="date" id="end_date" name="end_date" class="form-control" value="{{ request.GET.end_date }}">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">Filter</button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header fw-bold">Contacts by Owner and Call Type</div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-bordered table-sm align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Owner</th>
                        {% for ct in calltype_list %}
                        <th class="text-center">{{ ct.code }}</th>
                        {% endfor %}
                        <th class="text-end">Total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for owner in owners %}
                    <tr>
                        <td>{{ owner.name }}</td>
                        {% for ct in calltype_list %}
                        <td class="text-center">{{ matrix|get_item:owner.id|get_item:ct.code }}</td>
                        {% endfor %}
                        <td class="text-end">{{ totals_by_owner|get_item:owner.id }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <th class="text-end">Totals</th>
                        {% for ct in calltype_list %}
                        <th class="text-center">{{ totals_by_calltype|get_item:ct.code }}</th>
                        {% endfor %}
                        <th class="text-end">{{ grand_total }}</th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header fw-bold">FOV Reports</div>
    <div class="card-body">
        <div class="d-flex flex-column">
            {% for report in fov_reports %}
            <div class="card shadow-sm mb-3">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title"><a href="{% url 'report_dashboard' report.id %}">{{ report.subject }}</a></h5>
                    <p class="card-text mb-1"><strong>Date Created:</strong> {{ report.created_at }}</p>
                    <p class="card-text mb-1"><strong>Office:</strong> {{ report.office.name }}</p>
                    <p class="card-text mb-1"><strong>Owner:</strong> {{ report.owner.name }}</p>
                    <div class="mb-2">
                        <strong>Content:</strong>
                        <div class="border rounded p-2 bg-light">{{ report.content }}</div>
                    </div>
                    <a class="btn btn-sm btn-secondary mt-auto align-self-start" href="{% url 'report_dashboard' report.id %}">View Report</a>
                </div>
            </div>
            {% empty %}
            <div class="alert alert-muted text-center">No FOV reports found for the selected date range.</div>
            <br>
            {% endfor %}
        </div>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header fw-bold">Reports Directory</div>
    <div class="card-body p-0">
        {% if show_table %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Subject</th>
                        <th>Date Created</th>
                        <th>Employee</th>
                        <th>Office</th>
                        <th>Owner</th>
                        <th>Log Report</th>
                    </tr>
                </thead>
                <tbody>
                    {% for report in reports %}
                    <tr>
                        <td><a href="{% url 'report_dashboard' report.id %}">{{ report.subject }}</a></td>
                        <td>{{ report.created_at }}</td>
                        <td>{{ report.employee.name }}</td>
                        <td>{{ report.office.name }}</td>
                        <td>{{ report.owner.name }}</td>
                        <td><a class="btn btn-sm btn-secondary" href="{% url 'report_dashboard' report.id %}">View Report</a></td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">No reports found for the selected date range.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center text-muted">Please select a date range and click "Filter" to view reports.</p>
        {% endif %}
    </div>
</div>

<div class="card mb-4">
    <div class="card-header fw-bold">Contacts Per Owner</div>
    <div class="card-body">
        {{contacts_per_owner|safe}}
    </div>
</div>

{% endblock content %}