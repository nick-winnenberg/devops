
{% extends "owners/base.html" %}
{% block content %}

<div class="row mb-4">
    <div class="col text-center">
        <h2 class="fw-bold">EEP Dev Ops</h2>
        <p class="lead">Maintained by Nick Winnenberg</p>
        <p class="text-muted">Today's date: {{ current_date }}</p>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">Today</div>
            <div class="card-body">
                <div class="fs-5 fw-bold">All Reports: {{ today_reports_count }}</div>
                <div class="fs-6">Fov: {{ today_fovs }}</div>
            </div>
        </div>
    </div>
        <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">This Week</div>
            <div class="card-body">
                <div class="fs-5 fw-bold">All Reports: {{ this_week_number_reports_count }}</div>
                <div class="fs-6">Fov: {{ this_week_number_fov_counts }}</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">Last Week</div>
            <div class="card-body">
                <div class="fs-5 fw-bold text-primary">All Reports: {{ last_week_number_reports_count }}</div>
                <div class="fs-6 text-primary">Fov: {{ last_week_number_fov_counts }}</div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">Last Week</div>
            <div class="card-body">
                <div class="fs-5 fw-bold text-primary">All Reports: {{ last_month_number_reports_count }}</div>
                <div class="fs-6 text-primary">Fov: {{  last_month_number_fov_counts }}</div>
            </div>
        </div>
    </div>
</div>



<div class="row">
</div>
<div class="row">
    {% for office in offices %}
    <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
            <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                <span><i class="fas fa-building me-2"></i>{{ office.name }}</span>
                <small class="badge bg-light text-dark">O: {{ office.owners.all|length }} | E: {{ office.employees.all|length }}</small>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for owner in office.owners.all %}
                        <tr>
                            <td>{{ owner.name }}</td>
                            <td><span class="badge">Owner</span></td>
                            <td>
                                <a href="{% url 'log_call_from_owner' owner.id %}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-file-alt me-1"></i>Report
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% for employee in office.employees.all %}
                        <tr>
                            <td>{{ employee.name }}</td>
                            <td><span class="badge">Employee</span></td>
                            <td>
                                <a href="{% url 'log_call_from_employee' employee.id %}" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-file-alt me-1"></i>Report
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% if not office.owners.all and not office.employees.all %}
                        <tr>
                            <td colspan="3" class="text-center text-muted">No owners or employees assigned</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <div class="card-footer text-end">
                <a href="{% url 'employee_create' office.id %}" class="btn btn-success btn-sm">
                    <i class="fas fa-plus me-1"></i>Add Employee
                </a>
                    <a href="{% url 'owner_create_from_office' office.id%}" class="btn btn-success btn-sm">
                    <i class="fas fa-plus me-1"></i>Add Owner
                    </a>
                    <a href="{% url 'office_delete' office.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this office?')">
                        <i class="fas fa-trash me-1"></i>Delete Office
                    </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<div class="row mb-4">
    <div class="col">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="fas fa-users me-2"></i>Owners</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Owner Name</th>
                                <th>Offices</th>
                                <th>View Dashboard</th>
                                <th>Add Office</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for owner in owners %}
                            <tr>
                                <td>{{ owner.name }}</td>
                                <td>
                                    {% for office in owner.offices.all %}
                                        <span class="badge">{{ office.name }}</span>
                                    {% empty %}
                                        <span class="text-muted">No offices</span>
                                    {% endfor %}
                                </td>
                                <td>
                                    <a href="{% url 'owner_dashboard' owner.id %}" class="btn btn-primary btn-sm">
                                        <i class="fas fa-arrow-right me-1"></i>View Dashboard
                                    </a>
                                </td>
                                <td>
                                    <a href="{% url 'office_create' owner.id %}" class="btn btn-success btn-sm">
                                        <i class="fas fa-plus me-1"></i>Add Office
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                            <tr>
                                <td colspan="4" class="text-center">
                                    <a href="{% url 'owner_create' %}" class="btn btn-outline-success">
                                        <i class="fas fa-plus me-1"></i>Create New Owner
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
</div>



{% endblock %}